function sort (query) {
  var sortArray;
  var sortObj;

  if (!query.sort) return null;

  sortArray = query.sort.split(',');
  sortObj = {};

  sortArray.forEach(function (field) {
    var f = field;
    var prefix = 1;

    if (f.match(/-/)) prefix = -1;
    f = f.replace(/-|\s/g, '');

    sortObj[f] = prefix;
  });

  return sortObj;
}

module.exports = function () {
  return function (req, res, next) {
    if (!req.options) req.options = {};
    req.options.sort = sort(req.query);

    next();
  };
};
