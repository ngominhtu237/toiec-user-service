var Item = require('./model');
var express = require('express');
var mongoose = require('mongoose');
var queryHandler = require('..');
var app = express();

mongoose.connect('mongodb://localhost/queryhandler_test');

app.use(queryHandler.fields());
app.use(queryHandler.filter());
app.use(queryHandler.pagination());
app.use(queryHandler.sort());

app.get('/', function (req, res) {
  Item.find(req.where, req.fields, req.options, function (err, items) {
    if (err) throw err;
    res.json(items);
  });
});

module.exports = app;
